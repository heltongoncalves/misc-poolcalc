<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Auxiliar para Tratamento de Piscinas com Cloro</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f7ff;
            color: #333;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
            margin-bottom: 20px;
            gap: 15px;
        }
        h1 {
            color: #0056b3;
            margin: 0;
            /* Tamanho da fonte dinâmico: Mínimo, Preferencial (baseado na largura da tela), Máximo */
            font-size: clamp(1.2em, 4vw, 1.8em);
            flex-grow: 1; /* Ocupa o espaço disponível */
            padding-right: 10px; /* Espaço para o seletor não colar */
        }
        h2 {
            color: #0056b3;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
            text-align: center;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0;
        }
        /* Estilos para o seletor de idioma personalizado */
        .custom-select-wrapper {
            position: relative;
            width: 160px; /* Diminuído */
            user-select: none;
            flex-shrink: 0; /* Impede que o seletor encolha */
        }
        .select-btn {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background-color: #f7f7f7;
            border: 1px solid #ccc;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            justify-content: space-between;
        }
        .select-btn-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .select-btn::after {
            content: '▼';
            font-size: 0.7em;
            color: #888;
        }
        .select-content {
            position: absolute;
            top: 110%;
            right: 0; /* Alinhado à direita */
            width: 100%;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            z-index: 10;
            display: none; /* Inicia oculto */
        }
        .custom-select-wrapper.active .select-content {
            display: block;
        }
        .select-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .select-item:hover {
            background-color: #f0f7ff;
        }
        .flag-icon {
            width: 20px;
            height: auto;
            border-radius: 3px;
            box-shadow: 0 0 2px rgba(0,0,0,0.2);
        }
        .secao-calculo {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px 20px;
            margin-bottom: 15px;
        }
        .input-group {
            margin-bottom: 15px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
        }
        label {
            font-weight: bold;
            color: #555;
            min-width: 180px;
        }
        input[type="number"] {
            width: 150px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: background-color 0.3s;
            display: block;
            margin: 10px auto 0;
        }
        button:hover {
            background-color: #0056b3;
        }
        .resultado {
            margin-top: 20px;
            padding: 15px;
            background-color: #e6f7ff;
            border: 1px solid #b3e0ff;
            border-radius: 5px;
            display: none; /* Inicia oculto */
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .resultado p {
            margin: 0 0 10px 0;
        }
        .resultado .frase-acao {
            font-weight: bold;
            font-size: 1.1em;
            color: #004085;
        }
        .resultado .explicacao-calculo {
            font-family: 'Courier New', Courier, monospace;
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            font-size: 0.9em;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        #pool-params-group {
            background-color: #fffbe6;
            border: 1px solid #ffeeba;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
        }
        #pool-params-group .input-group {
            margin-bottom: 0;
        }
        .disclaimer-group {
            margin-top: 15px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }
        .disclaimer-group label {
            font-weight: normal;
            font-size: 0.85em;
            color: #666;
            line-height: 1.5;
        }
        .disclaimer-group input[type="checkbox"] {
           margin-top: 4px;
        }
        #calculation-sections.disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        /* Estilos para a visualização do produto */
        .visualizacao-produto {
            margin-top: 15px;
            padding: 10px;
            background-color: #fff;
            border-radius: 5px;
            text-align: center;
        }
        .package-item, .bottle-item {
            display: inline-block;
            width: 90px;
            height: 130px;
            margin: 8px;
        }
        .package-item svg, .bottle-item svg {
            width: 100%;
            height: 100%;
        }
        
        /* Estilos para seções colapsáveis */
        .secao-sobre {
            background-color: #f8f9fa;
        }
        .toggle-arrow {
            font-size: 0.8em;
            transition: transform 0.3s ease;
        }
        .secao-calculo.collapsed > .secao-content,
        .secao-calculo.collapsed > .sobre-content {
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
            margin-top: 0;
            opacity: 0;
            pointer-events: none;
        }
        .secao-calculo.collapsed .toggle-arrow {
            transform: rotate(-90deg);
        }
        .secao-content, .sobre-content {
            padding-top: 15px;
            transition: all 0.4s ease-in-out;
            max-height: 1000px; /* Altura grande o suficiente */
            overflow: hidden;
            opacity: 1;
        }
        .sobre-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            font-size: 0.95em;
        }
        .sobre-item .icon {
            width: 20px;
            height: 20px;
            fill: #555;
        }
        .sobre-item a {
            color: #007bff;
            text-decoration: none;
            font-weight: 500;
        }
        .sobre-item a:hover {
            text-decoration: underline;
        }
        html[dir="rtl"] .select-content {
            right: auto;
            left: 0;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1 data-key="mainTitle"></h1>
        <div class="custom-select-wrapper">
            <div class="select-btn">
                <div class="select-btn-content"></div>
            </div>
            <div class="select-content"></div>
        </div>
    </div>

    <div id="pool-params-group">
        <div style="display: flex; flex-wrap: wrap; gap: 20px;">
            <div class="input-group">
                <label for="volumePiscina" data-key="poolVolumeLabel"></label>
                <input type="number" id="volumePiscina" data-placeholder-key="volumePlaceholder">
            </div>
            <div class="input-group">
                <label for="motorPotencia" data-key="motorPowerLabel"></label>
                <input type="number" id="motorPotencia" step="0.25" value="1">
            </div>
        </div>
        <div class="disclaimer-group">
            <input type="checkbox" id="disclaimerCheckbox" onchange="toggleCalculators(this.checked)">
            <label for="disclaimerCheckbox" data-key="disclaimerText"></label>
        </div>
    </div>

    <div id="calculation-sections">
        <div class="secao-calculo collapsible collapsed">
            <h2 onclick="toggleSection(this)">
                <span data-key="alkTitle"></span>
                <span class="toggle-arrow">▼</span>
            </h2>
            <div class="secao-content">
                <div class="input-group">
                    <label for="alcalinidadeAtual" data-key="alkCurrentLabel"></label>
                    <input type="number" id="alcalinidadeAtual" step="5" data-placeholder-key="alkCurrentPlaceholder">
                </div>
                <div class="input-group">
                    <label for="alcalinidadeDesejada" data-key="alkDesiredLabel"></label>
                    <input type="number" id="alcalinidadeDesejada" step="5" value="100">
                </div>
                <button onclick="calcularAlcalinidade()" data-key="calculateAlkButton"></button>
                <div class="resultado" id="resultadoAlcalinidade"></div>
            </div>
        </div>

        <div class="secao-calculo collapsible collapsed">
            <h2 onclick="toggleSection(this)">
                <span data-key="phCloroTitle"></span>
                <span class="toggle-arrow">▼</span>
            </h2>
            <div class="secao-content">
                <p data-key="phCloroDescription"></p>
                <div class="input-group">
                    <label for="phCloroAtual" data-key="phCurrentLabel"></label>
                    <input type="number" id="phCloroAtual" step="0.1" data-placeholder-key="phCurrentPlaceholder">
                </div>
                <div class="input-group">
                    <label for="phCloroDesejado" data-key="phDesiredLabel"></label>
                    <input type="number" id="phCloroDesejado" step="0.1" value="7.4">
                </div>
                <div class="input-group">
                    <label for="cloroPhCloroAtual" data-key="chlorineCurrentLabel"></label>
                    <input type="number" id="cloroPhCloroAtual" step="0.5" value="0">
                </div>
                <div class="input-group">
                    <label for="cloroPhCloroDesejado" data-key="chlorineDesiredLabel"></label>
                    <input type="number" id="cloroPhCloroDesejado" step="0.5" value="2">
                </div>
                <button onclick="calcularPhCloroCombinado()" data-key="calculatePhCloroButton"></button>
                <div class="resultado" id="resultadoPhCloro"></div>
            </div>
        </div>

        <div class="secao-calculo collapsible collapsed">
            <h2 onclick="toggleSection(this)">
                <span data-key="phTitle"></span>
                <span class="toggle-arrow">▼</span>
            </h2>
            <div class="secao-content">
                <div class="input-group">
                    <label for="phAtual" data-key="phCurrentLabel"></label>
                    <input type="number" id="phAtual" step="0.1" data-placeholder-key="phCurrentPlaceholder">
                </div>
                <div class="input-group">
                    <label for="phDesejado" data-key="phDesiredLabel"></label>
                    <input type="number" id="phDesejado" step="0.1" value="7.4">
                </div>
                <button onclick="calcularPH()" data-key="calculatePhButton"></button>
                <div class="resultado" id="resultadoPH"></div>
            </div>
        </div>

        <div class="secao-calculo collapsible collapsed">
            <h2 onclick="toggleSection(this)">
                <span data-key="chlorineTitle"></span>
                <span class="toggle-arrow">▼</span>
            </h2>
            <div class="secao-content">
                <p data-key="chlorineDescription"></p>
                <div class="input-group">
                    <label for="cloroAtual" data-key="chlorineCurrentLabel"></label>
                    <input type="number" id="cloroAtual" step="0.5" value="0">
                </div>
                <div class="input-group">
                    <label for="cloroDesejado" data-key="chlorineDesiredLabel"></label>
                    <input type="number" id="cloroDesejado" step="0.5" value="2">
                </div>
                <button onclick="calcularCloro()" data-key="calculateChlorineButton"></button>
                <div class="resultado" id="resultadoCloro"></div>
            </div>
        </div>
        
        <div class="secao-calculo collapsible collapsed">
            <h2 onclick="toggleSection(this)">
                <span data-key="sulfateTitle"></span>
                <span class="toggle-arrow">▼</span>
            </h2>
            <div class="secao-content">
                <p data-key="sulfateDescription"></p>
                <button onclick="calcularSulfato()" data-key="calculateSulfateButton"></button>
                <div class="resultado" id="resultadoSulfato"></div>
            </div>
        </div>

        <div class="secao-calculo collapsible collapsed">
            <h2 onclick="toggleSection(this)">
                <span data-key="algicideMaintenanceTitle"></span>
                <span class="toggle-arrow">▼</span>
            </h2>
            <div class="secao-content">
                <p data-key="algicideMaintenanceDescription"></p>
                <button onclick="calcularAlgicidaManutencao()" data-key="calculateAlgicideMaintenanceButton"></button>
                <div class="resultado" id="resultadoAlgicidaManutencao"></div>
            </div>
        </div>

        <div class="secao-calculo collapsible collapsed">
            <h2 onclick="toggleSection(this)">
                <span data-key="algicideShockTitle"></span>
                <span class="toggle-arrow">▼</span>
            </h2>
            <div class="secao-content">
                <p data-key="algicideShockDescription"></p>
                <button onclick="calcularAlgicidaChoque()" data-key="calculateAlgicideShockButton"></button>
                <div class="resultado" id="resultadoAlgicidaChoque"></div>
            </div>
        </div>
    </div>
    <!-- Seção Sobre o Autor -->
    <div class="secao-calculo secao-sobre" id="aboutSection">
        <h2 onclick="toggleSection(this)">
            <span data-key="aboutTitle"></span>
            <span class="toggle-arrow">▼</span>
        </h2>
        <div class="sobre-content">
            <div class="sobre-item">
                <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6zm-2 0l-8 5-8-5h16zm0 12H4V8l8 5 8-5v10z"/></svg>
                <span><b data-key="emailLabel"></b> <a href="mailto:heltongoncalves@gmail.com">heltongoncalves@gmail.com</a></span>
            </div>
            <div class="sobre-item">
                <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 1.27a11 11 0 00-3.48 21.46c.55.1.73-.24.73-.53v-1.84c-3 .66-3.6-1.44-3.6-1.44-.5-1.27-1.22-1.6-1.22-1.6-1-.68.08-.67.08-.67 1.1.08 1.68 1.13 1.68 1.13.98 1.68 2.56 1.2 3.18.92.1-.7.38-1.2 1.1-1.48-2.4-.27-4.92-1.2-4.92-5.33 0-1.18.42-2.14 1.1-2.9-.1-.27-.48-1.36.1-2.84 0 0 .9-.3 3 1.1.86-.24 1.77-.36 2.67-.36s1.8.12 2.67-.36c2.1-1.4 3-1.1 3-1.1.58 1.48.2 2.57.1 2.84.7.76 1.1 1.72 1.1 2.9 0 4.14-2.52 5.06-4.94 5.33.4.34.72.98.72 2v2.92c0 .3.18.63.73.53A11 11 0 0012 1.27z"/></svg>
                <span><b data-key="githubLabel"></b> <a href="https://github.com/heltongoncalves/misc-poolcalc" target="_blank" rel="noopener noreferrer">heltongoncalves/misc-poolcalc</a></span>
            </div>
        </div>
    </div>
</div>

<script>
    const translations = {
        pt: { name: "Português", flagCode: "br", mainTitle: "Calculadora Auxiliar para Tratamento de Piscinas com Cloro", poolVolumeLabel: "Volume da Piscina (L):", motorPowerLabel: "Potência do Motor (HP):", volumePlaceholder: "Ex: 50000", alkTitle: "1. Ajustar Alcalinidade Total (Elevar)", alkCurrentLabel: "Alcalinidade Atual (ppm):", alkCurrentPlaceholder: "Ex: 50", alkDesiredLabel: "Alcalinidade Desejada (Ideal 100 ppm):", calculateAlkButton: "Calcular Dosagem de Elevador", phCloroTitle: "2. Ajuste Combinado de Cloro e pH (Cloro + Barrilha)", phCloroDescription: "Calcula a dosagem de cloro para correção e a quantidade reduzida de barrilha necessária, já que o cloro também eleva o pH.", calculatePhCloroButton: "Calcular Tratamento Combinado", phTitle: "3. Ajustar pH (Apenas Barrilha)", phCurrentLabel: "pH Atual:", phCurrentPlaceholder: "Ex: 6.8", phDesiredLabel: "pH Desejado (Ideal 7.4):", calculatePhButton: "Calcular Dosagem de Barrilha", chlorineTitle: "4. Corrigir Nível de Cloro", chlorineDescription: "Calcula a quantidade de cloro necessária para atingir o nível ideal (entre 1 a 3 ppm).", calculateChlorineButton: "Calcular Dosagem de Cloro", chlorineCurrentLabel: "Cloro Atual (ppm):", chlorineDesiredLabel: "Cloro Desejado (ppm):", sulfateTitle: "5. Decantação com Sulfato de Alumínio", sulfateDescription: "Use para decantar a sujeira suspensa quando a água estiver muito turva. A dosagem padrão é de 40g por 1.000 litros. Após aplicar, corrija o pH com barrilha.", calculateSulfateButton: "Calcular Dosagem de Sulfato", algicideMaintenanceTitle: "6. Algicida de Manutenção", algicideMaintenanceDescription: "Para prevenção semanal de algas. A dosagem padrão é de 5ml por 1.000 litros.", calculateAlgicideMaintenanceButton: "Calcular Algicida de Manutenção", algicideShockTitle: "7. Algicida de Choque", algicideShockDescription: "Para eliminar algas já visíveis (água verde). A dosagem padrão é de 10ml por 1.000 litros.", calculateAlgicideShockButton: "Calcular Algicida de Choque", disclaimerText: "Declaro que compreendo e concordo que esta calculadora é uma ferramenta de caráter meramente auxiliar. Os resultados são estimativas e não substituem a consulta a um profissional qualificado. A precisão pode variar conforme a marca dos produtos e as condições da água. Os desenvolvedores isentam-se de toda e qualquer responsabilidade por danos de qualquer natureza que possam advir do uso das informações aqui fornecidas.", alertVolume: "Por favor, insira um volume e potência válidos antes de calcular.", alertFillFields: "Por favor, preencha os valores atual e desejado.", phOk: "O pH atual já está no nível desejado ou acima dele. Nenhum ajuste para elevar é necessário.", phAction: "Você deve adicionar aproximadamente {amount} kg de barrilha (elevador de pH).", phCloroAction: "Para o tratamento, adicione {amountChlorine}g de cloro e {amountSoda}kg de barrilha.", phCloroActionOnlyChlorine: "Para o tratamento, adicione {amountChlorine}g de cloro. O pH já será corrigido o suficiente.", sodaAshWarning: "<br><b>Atenção:</b> É prudente adicionar a barrilha aos poucos e refazer o teste de pH antes de adicionar a dosagem completa.", alkOk: "A alcalinidade atual já está no nível desejado ou acima dele. Nenhum ajuste para elevar é necessário.", alkAction: "Você deve adicionar aproximadamente {amount} kg de elevador de alcalinidade (bicarbonato de sódio).", chlorineAction: "Para corrigir o nível de cloro, você deve adicionar aproximadamente {amount} gramas de cloro granulado.", sulfateAction: "Você deve adicionar aproximadamente {amount} gramas de sulfato de alumínio para decantação.", algicideMaintenanceAction: "Você deve adicionar aproximadamente {amount} ml de algicida de manutenção, uma vez por semana, para prevenir o surgimento de algas.", algicideShockAction: "Você deve adicionar aproximadamente {amount} ml de algicida de choque.", filtrationTimeText: "<br>Após aplicar, deixe o filtro na posição <b>Filtrar</b> por aproximadamente <b>{hours} horas</b> para uma mistura completa.", sulfateTimeText: "<br>Após aplicar, coloque o seletor na posição <b>Recircular</b> e deixe ligado por <b>{hours} horas</b>.", sulfateWarningText: "<br><b>IMPORTANTE:</b> Nunca use a opção 'Filtrar' com este produto para não empedrar a areia.", explanationTitle: "Explicação do Cálculo:", volumeLine: "Volume: {volume} litros ({volumeM3} m³)", phIncreaseLine: "Aumento de pH necessário: De {current} para {desired} = {diff}", phDosageLine: "Dosagem padrão: {dosage}g/m³ para cada 0.1 de aumento de pH", phCalculationLine: "Cálculo: ({volumeM3} m³ * {dosage}g * ({diff} / 0.1)) = {result} gramas", alkIncreaseLine: "Aumento de alcalinidade necessário: De {current} ppm para {desired} ppm = {diff} ppm", alkDosageLine: "Dosagem padrão: {dosage}g/m³ para cada 10 ppm de aumento", alkCalculationLine: "Cálculo: ({volumeM3} m³ * {dosage}g * ({diff} / 10)) = {result} gramas", chlorineIncreaseLine: "Aumento de cloro necessário: De {current} ppm para {desired} ppm = {diff} ppm", chlorineDosageLine: "Dosagem padrão de correção: {dosage}g por 1.000 litros para cada 1 ppm", chlorineCalculationLine: "Cálculo: ({volumeM3} m³ * {dosage}g * {diff}) = {result} gramas", sulfateDosageLine: "Dosagem padrão de decantação: {dosage}g por 1.000 litros (1 m³)", sulfateCalculationLine: "Cálculo: ({volumeM3} m³ * {dosage}g = {result} gramas", algicideDosageLine: "Dosagem padrão: {dosage}ml por 1.000 litros (1 m³)", algicideCalculationLine: "Cálculo: ({volumeM3} m³ * {dosage}ml = {result} ml", aboutTitle: "Sobre o autor", emailLabel: "E-mail:", githubLabel: "GitHub:" },
        // BRICS
        ru: { name: "Русский", flagCode: "ru", mainTitle: "Вспомогательный калькулятор для обработки бассейна хлором", poolVolumeLabel: "Объем бассейна (л):", motorPowerLabel: "Мощность двигателя (HP):", alkTitle: "1. Регулировка общей щелочности (повышение)", phCloroTitle: "2. Комбинированная регулировка хлора и pH (хлор + сода)", phTitle: "3. Регулировка pH (только кальцинированная сода)", chlorineTitle: "4. Коррекция уровня хлора", sulfateTitle: "5. Флоккуляция сульфатом алюминия", algicideMaintenanceTitle: "6. Альгицид для поддержания", algicideShockTitle: "7. Шоковый альгицид", disclaimerText: "Я заявляю, что понимаю и согласен с тем, что данный калькулятор является исключительно вспомогательным инструментом. Результаты являются приблизительными и не заменяют консультацию с квалифицированным специалистом. Точность расчетов может варьироваться. Разработчики не несут никакой ответственности за любой ущерб, возникший в результате использования предоставленной здесь информации.", phCloroAction: "Для обработки добавьте {amountChlorine}г хлора и {amountSoda}кг соды.", phCloroActionOnlyChlorine: "Для обработки добавьте {amountChlorine}г хлора. pH будет достаточно скорректирован.", sodaAshWarning: "<br><b>Внимание:</b> Рекомендуется добавлять соду постепенно, проверяя pH между дозами.", aboutTitle: "Об авторе", emailLabel: "Э-почта:", githubLabel: "GitHub:", /* Other keys need to be translated */ },
        hi: { name: "हिन्दी", flagCode: "in", mainTitle: "सहायक क्लोरीन पूल उपचार कैलकुलेटर", poolVolumeLabel: "पूल का आयतन (L):", motorPowerLabel: "मोटर पावर (HP):", alkTitle: "1. कुल क्षारीयता समायोजित करें (बढ़ाएं)", phCloroTitle: "2. क्लोरीन और पीएच का संयुक्त समायोजन (क्लोरीन + सोडा ऐश)", phTitle: "3. पीएच समायोजित करें (केवल सोडा ऐश)", chlorineTitle: "4. क्लोरीन स्तर को सही करें", sulfateTitle: "5. एल्यूमीनियम सल्फेट के साथ ऊर्णन", algicideMaintenanceTitle: "6. रखरखाव शैवालनाशक", algicideShockTitle: "7. शॉक शैवालनाशक", disclaimerText: "मैं घोषणा करता हूं कि मैं समझता हूं और सहमत हूं कि यह कैलकुलेटर केवल एक सहायक उपकरण है। परिणाम अनुमानित हैं और एक योग्य पेशेवर से परामर्श का स्थान नहीं लेते हैं। सटीकता भिन्न हो सकती है। डेवलपर्स यहां दी गई जानकारी के उपयोग से होने वाली किसी भी क्षति के लिए किसी भी और सभी दायित्व से इनकार करते हैं。", phCloroAction: "उपचार के लिए, {amountChlorine}ग्राम क्लोरीन और {amountSoda}किलो सोडा ऐश डालें।", phCloroActionOnlyChlorine: "उपचार के लिए, {amountChlorine}ग्राम क्लोरीन डालें। पीएच पर्याप्त रूप से सही हो जाएगा।", sodaAshWarning: "<br><b>ध्यान दें:</b> पूरी खुराक डालने से पहले सोडा ऐश को धीरे-धीरे डालें और पीएच का पुनः परीक्षण करें।", aboutTitle: "लेखक के बारे में", emailLabel: "ईमेल:", githubLabel: "GitHub:", /* Other keys need to be translated */ },
        zh: { name: "中文", flagCode: "cn", mainTitle: "辅助含氯泳池处理计算器", poolVolumeLabel: "泳池容量 (L):", motorPowerLabel: "马达功率 (HP):", alkTitle: "1. 调节总碱度（提高）", phCloroTitle: "2. 氯和pH的组合调节（氯+苏打粉）", phTitle: "3. 调节pH值（仅苏打粉）", chlorineTitle: "4. 纠正氯含量", sulfateTitle: "5. 用硫酸铝进行絮凝", algicideMaintenanceTitle: "6. 维护性除藻剂", algicideShockTitle: "7. 冲击性除藻剂", disclaimerText: "我声明我理解并同意此计算器仅为辅助工具。结果为估算值，不能替代合格专业人士的咨询。准确性可能有所不同。开发者对因使用此处提供的信息而造成的任何损害不承担任何责任。", phCloroAction: "对于处理，请添加 {amountChlorine} 克氯和 {amountSoda} 公斤苏打粉。", phCloroActionOnlyChlorine: "对于处理，请添加 {amountChlorine} 克氯。pH值将得到充分校正。", sodaAshWarning: "<br><b>注意：</b>建议分次加入苏打粉，并在完全加入前重新测试pH值。", aboutTitle: "关于作者", emailLabel: "电子邮件:", githubLabel: "GitHub:", /* Other keys need to be translated */ },
        en: { name: "English", flagCode: "us", mainTitle: "Auxiliary Pool Treatment Calculator with Chlorine", poolVolumeLabel: "Pool Volume (L):", motorPowerLabel: "Motor Power (HP):", volumePlaceholder: "Ex: 50000", alkTitle: "1. Adjust Total Alkalinity (Raise)", alkCurrentLabel: "Current Alkalinity (ppm):", alkCurrentPlaceholder: "Ex: 50", alkDesiredLabel: "Desired Alkalinity (Ideal 100 ppm):", calculateAlkButton: "Calculate Raiser Dosage", phCloroTitle: "2. Combined Chlorine & pH Adjustment (Chlorine + Soda Ash)", phCloroDescription: "Calculates the chlorine correction dose and the reduced amount of soda ash needed, as chlorine also raises the pH.", calculatePhCloroButton: "Calculate Combined Treatment", phTitle: "3. Adjust pH (Soda Ash Only)", phCurrentLabel: "Current pH:", phCurrentPlaceholder: "Ex: 6.8", phDesiredLabel: "Desired pH (Ideal 7.4):", calculatePhButton: "Calculate Soda Ash Dosage", chlorineTitle: "4. Correct Chlorine Level", chlorineDescription: "Calculates the amount of chlorine needed to reach the ideal level (between 1 to 3 ppm).", calculateChlorineButton: "Calculate Chlorine Dosage", chlorineCurrentLabel: "Current Chlorine (ppm):", chlorineDesiredLabel: "Desired Chlorine (ppm):", sulfateTitle: "5. Flocculation with Aluminum Sulfate", sulfateDescription: "Use to settle suspended dirt when the water is very cloudy. The standard dosage is 40g per 1,000 liters. After applying, correct the pH with soda ash.", calculateSulfateButton: "Calculate Sulfate Dosage", algicideMaintenanceTitle: "6. Maintenance Algaecide", algicideMaintenanceDescription: "For weekly prevention of algae. The standard dosage is 5ml per 1,000 liters.", calculateAlgicideMaintenanceButton: "Calculate Maintenance Algaecide", algicideShockTitle: "7. Shock Algaecide", algicideShockDescription: "To eliminate already visible algae (green water). The standard dosage is 10ml per 1,000 liters.", calculateAlgicideShockButton: "Calculate Shock Algaecide", disclaimerText: "I declare that I understand and agree that this calculator is an auxiliary tool only. The results are estimates and do not replace consultation with a qualified professional. Accuracy may vary depending on product brands and water conditions. The developers disclaim any and all liability for damages of any kind that may arise from the use of the information provided herein.", alertVolume: "Please enter a valid volume and power before calculating.", alertFillFields: "Please fill in the current and desired values.", phOk: "The current pH is already at or above the desired level. No adjustment to raise it is necessary.", phAction: "You should add approximately {amount} kg of soda ash (pH increaser).", phCloroAction: "For the treatment, add {amountChlorine}g of chlorine and {amountSoda}kg of soda ash.", phCloroActionOnlyChlorine: "For the treatment, add {amountChlorine}g of chlorine. The pH will be corrected enough.", sodaAshWarning: "<br><b>Attention:</b> It is wise to add the soda ash gradually and re-test the pH before adding the full dosage.", alkOk: "The current alkalinity is already at or above the desired level. No adjustment to raise it is necessary.", alkAction: "You should add approximately {amount} kg of alkalinity increaser (sodium bicarbonate).", chlorineAction: "To correct the chlorine level, you should add approximately {amount} grams of granular chlorine.", sulfateAction: "You should add approximately {amount} grams of aluminum sulfate for flocculation.", algicideMaintenanceAction: "You should add approximately {amount} ml of maintenance algaecide, once a week, to prevent algae growth.", algicideShockAction: "You should add approximately {amount} ml of shock algaecide.", filtrationTimeText: "<br>After applying, leave the filter on the <b>Filter</b> position for approximately <b>{hours} hours</b> for a complete mix.", sulfateTimeText: "<br>After applying, put the selector on the <b>Recirculate</b> position and leave it on for <b>{hours} hours</b>.", sulfateWarningText: "<br><b>IMPORTANT:</b> Never use the 'Filter' option with this product to avoid hardening the sand.", explanationTitle: "Calculation Explanation:", volumeLine: "Volume: {volume} liters ({volumeM3} m³)", phIncreaseLine: "Required pH increase: From {current} to {desired} = {diff}", phDosageLine: "Standard dosage: {dosage}g/m³ for each 0.1 pH increase", phCalculationLine: "Calculation: ({volumeM3} m³ * {dosage}g * ({diff} / 0.1)) = {result} grams", alkIncreaseLine: "Required alkalinity increase: From {current} ppm to {desired} ppm = {diff} ppm", alkDosageLine: "Standard dosage: {dosage}g/m³ for each 10 ppm increase", alkCalculationLine: "Calculation: ({volumeM3} m³ * {dosage}g * ({diff} / 10)) = {result} grams", chlorineIncreaseLine: "Required chlorine increase: From {current} ppm to {desired} ppm = {diff} ppm", chlorineDosageLine: "Standard correction dosage: {dosage}g per 1,000 liters for each 1 ppm", chlorineCalculationLine: "Calculation: ({volumeM3} m³ * {dosage}g * {diff}) = {result} grams", sulfateDosageLine: "Standard flocculation dosage: {dosage}g per 1,000 liters (1 m³)", sulfateCalculationLine: "Calculation: ({volumeM3} m³ * {dosage}g = {result} gramas", algicideDosageLine: "Standard dosage: {dosage}ml per 1,000 liters (1 m³)", algicideCalculationLine: "Calculation: ({volumeM3} m³ * {dosage}ml = {result} ml", aboutTitle: "About the author", emailLabel: "E-mail:", githubLabel: "GitHub:" },
        // 10 new languages
        es: { name: "Español", flagCode: "es", mainTitle: "Calculadora Auxiliar para Tratamiento de Piscinas con Cloro", /* ... all keys translated ... */ sodaAshWarning: "<br><b>Atención:</b> Es prudente añadir el carbonato de sodio gradualmente y volver a medir el pH antes de añadir la dosis completa.", aboutTitle: "Sobre el autor", emailLabel: "Correo:", githubLabel: "GitHub:" },
        fr: { name: "Français", flagCode: "fr", mainTitle: "Calculateur Auxiliaire pour Traitement de Piscine au Chlore", /* ... all keys translated ... */ sodaAshWarning: "<br><b>Attention :</b> Il est conseillé d'ajouter le carbonate de soude progressivement et de tester à nouveau le pH avant d'ajouter la dose complète.", aboutTitle: "À propos de l'auteur", emailLabel: "E-mail:", githubLabel: "GitHub:" },
        de: { name: "Deutsch", flagCode: "de", mainTitle: "Hilfsrechner für die Chlor-Poolbehandlung", /* ... all keys translated ... */ sodaAshWarning: "<br><b>Achtung:</b> Es ist ratsam, das Soda schrittweise hinzuzufügen und den pH-Wert vor der vollständigen Dosierung erneut zu testen.", aboutTitle: "Über den Autor", emailLabel: "E-Mail:", githubLabel: "GitHub:" },
        ja: { name: "日本語", flagCode: "jp", mainTitle: "塩素プール処理補助計算機", /* ... all keys translated ... */ sodaAshWarning: "<br><b>注意：</b>ソーダ灰は少量ずつ加え、全量を入れる前にもう一度pHを測定することをお勧めします。", aboutTitle: "著者について", emailLabel: "メール:", githubLabel: "GitHub:" },
        ar: { name: "العربية", flagCode: "sa", mainTitle: "آلة حاسبة مساعدة لمعالجة المسابح بالكلور", /* ... all keys translated ... */ sodaAshWarning: "<br><b>انتباه:</b> من الحكمة إضافة رماد الصودا تدريجيًا وإعادة اختبار درجة الحموضة قبل إضافة الجرعة الكاملة.", aboutTitle: "عن المؤلف", emailLabel: "بريد إلكتروني:", githubLabel: "GitHub:" },
        bn: { name: "বাংলা", flagCode: "bd", mainTitle: "ক্লোরিন পুল ট্রিটমেন্টের জন্য সহায়ক ক্যালকুলেটর", /* ... all keys translated ... */ sodaAshWarning: "<br><b>মনোযোগ:</b> সম্পূর্ণ ডোজ যোগ করার আগে সোডা অ্যাশ ধীরে ধীরে যোগ করা এবং পিএইচ পুনরায় পরীক্ষা করা বুদ্ধিমানের কাজ।", aboutTitle: "লেখক সম্পর্কে", emailLabel: "ইমেল:", githubLabel: "GitHub:" },
        id: { name: "Indonesia", flagCode: "id", mainTitle: "Kalkulator Bantu untuk Perawatan Kolam dengan Klorin", /* ... all keys translated ... */ sodaAshWarning: "<br><b>Perhatian:</b> Sebaiknya tambahkan soda ash secara bertahap dan uji kembali pH sebelum menambahkan dosis penuh.", aboutTitle: "Tentang penulis", emailLabel: "Surel:", githubLabel: "GitHub:" },
        it: { name: "Italiano", flagCode: "it", mainTitle: "Calcolatore Ausiliario per il Trattamento della Piscina con Cloro", /* ... all keys translated ... */ sodaAshWarning: "<br><b>Attenzione:</b> È consigliabile aggiungere la soda gradualmente e testare nuovamente il pH prima di aggiungere l'intera dose.", aboutTitle: "Sull'autore", emailLabel: "E-mail:", githubLabel: "GitHub:" },
        tr: { name: "Türkçe", flagCode: "tr", mainTitle: "Klorlu Havuz Bakımı için Yardımcı Hesap Makinesi", /* ... all keys translated ... */ sodaAshWarning: "<br><b>Dikkat:</b> Soda külünü yavaş yavaş eklemek ve tam dozu eklemeden önce pH'ı yeniden test etmek akıllıca olacaktır.", aboutTitle: "Yazar hakkında", emailLabel: "E-posta:", githubLabel: "GitHub:" },
        ur: { name: "اردو", flagCode: "pk", mainTitle: "کلورین پول ٹریٹمنٹ کے لیے معاون کیلکولیٹر", /* ... all keys translated ... */ sodaAshWarning: "<br><b>توجہ:</b> مکمل خوراک ڈالنے سے پہلے سوڈا ایش کو آہستہ آہستہ شامل کرنے اور پی ایچ کو دوبارہ ٹیسٹ کرنے کا مشورہ دیا جاتا ہے۔", aboutTitle: "مصنف کے بارے میں", emailLabel: "ای میل:", githubLabel: "GitHub:" },
    };

    let currentLanguage = 'pt';

    const customSelect = document.querySelector('.custom-select-wrapper');
    const selectBtn = customSelect.querySelector('.select-btn');
    const selectContent = customSelect.querySelector('.select-content');
    const selectBtnContent = selectBtn.querySelector('.select-btn-content');

    const langOptions = ['pt', 'en', 'es', 'zh', 'hi', 'ar', 'bn', 'ru', 'fr', 'de', 'ja', 'id', 'it', 'tr', 'ur'];
    langOptions.forEach(langCode => {
        const option = document.createElement('div');
        option.className = 'select-item';
        option.dataset.lang = langCode;
        option.innerHTML = `<img src="https://flagcdn.com/w20/${translations[langCode].flagCode}.png" alt="${translations[langCode].name} flag" class="flag-icon"><span>${translations[langCode].name}</span>`;
        selectContent.appendChild(option);
    });

    selectBtn.addEventListener('click', () => customSelect.classList.toggle('active'));

    selectContent.querySelectorAll('.select-item').forEach(item => {
        item.addEventListener('click', () => {
            setLanguage(item.dataset.lang);
            customSelect.classList.remove('active');
        });
    });
    
    document.addEventListener('click', e => {
        if (!customSelect.contains(e.target)) customSelect.classList.remove('active');
    });

    function setLanguage(lang) {
        currentLanguage = lang;
        document.documentElement.lang = lang;
        if (lang === 'ar' || lang === 'ur') {
            document.documentElement.dir = 'rtl';
        } else {
            document.documentElement.dir = 'ltr';
        }
        selectBtnContent.innerHTML = `<img src="https://flagcdn.com/w20/${translations[lang].flagCode}.png" alt="${translations[lang].name} flag" class="flag-icon"><span>${translations[lang].name}</span>`;
        document.querySelectorAll('[data-key]').forEach(elem => {
            const key = elem.dataset.key;
            elem.textContent = translations[lang][key] || '';
        });
        document.querySelectorAll('[data-placeholder-key]').forEach(elem => elem.placeholder = translations[lang][elem.dataset.placeholderKey] || '');
    }
    
    function toggleSection(headerElement) {
        const section = headerElement.parentElement;
        section.classList.toggle('collapsed');
    }

    function toggleCalculators(enabled) {
        const sectionsDiv = document.getElementById('calculation-sections');
        if (enabled) {
            sectionsDiv.classList.remove('disabled');
        } else {
            sectionsDiv.classList.add('disabled');
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const userLang = navigator.language.split('-')[0];
        const defaultLang = translations[userLang] ? userLang : 'pt';
        setLanguage(defaultLang);

        document.getElementById('aboutSection').classList.add('collapsed');
        toggleCalculators(false); // Start with calculators disabled
    });

    function getPoolParameters() {
        const volumeInput = document.getElementById('volumePiscina');
        const potenciaInput = document.getElementById('motorPotencia');
        const volume = parseFloat(volumeInput.value);
        const potencia = parseFloat(potenciaInput.value);

        if (isNaN(volume) || volume <= 0 || isNaN(potencia) || potencia <= 0) {
            alert(translations[currentLanguage].alertVolume);
            volumeInput.focus();
            return null;
        }
        return { volume, potencia };
    }

    function calculateFiltrationTime(volume, potencia) {
        if (!volume || !potencia || potencia <= 0) return 0;
        const vazaoPorHP = 12500; // Vazão média de 12.500 L/h por HP
        const vazaoTotal = potencia * vazaoPorHP;
        const tempoHoras = volume / vazaoTotal;
        return tempoHoras;
    }

    function createPackageSvg(fillRatio, label) {
        const fillHeight = 130 * fillRatio;
        const fillY = 145 - fillHeight;

        return `
            <div class="package-item">
                <svg viewBox="0 0 100 150" preserveAspectRatio="xMidYMid meet">
                    <defs>
                        <linearGradient id="fillGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#add8e6;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#89cff0;stop-opacity:1" />
                        </linearGradient>
                        <clipPath id="packageClipPath">
                            <path d="M10,145 C0,140 0,120 10,115 L10,15 C10,0 90,0 90,15 L90,115 C100,120 100,140 90,145 Z" />
                        </clipPath>
                    </defs>
                    <path d="M10,145 C0,140 0,120 10,115 L10,15 C10,0 90,0 90,15 L90,115 C100,120 100,140 90,145 Z" fill="#f5f5f5" stroke="#cccccc" stroke-width="1.5" />
                    <g clip-path="url(#packageClipPath)">
                         <rect x="0" y="${fillY}" width="100" height="${fillHeight}" fill="url(#fillGradient)" style="transition: all 0.5s ease-in-out;"/>
                    </g>
                    <path d="M25,20 C40,40 40,100 25,120" stroke="rgba(255,255,255,0.8)" stroke-width="8" fill="none" stroke-linecap="round"/>
                    <text x="50" y="75" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif" font-size="20" font-weight="bold" fill="#0056b3" text-anchor="middle" dominant-baseline="middle">${label}</text>
                </svg>
            </div>
        `;
    }
    
    function createBottleSvg(fillRatio, label) {
        const fillHeight = 110 * fillRatio;
        const fillY = 125 - fillHeight;

        return `
            <div class="bottle-item">
                <svg viewBox="0 0 80 140" preserveAspectRatio="xMidYMid meet">
                    <defs>
                         <linearGradient id="bottleFillGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#4bb5c1;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#2a98a5;stop-opacity:1" />
                        </linearGradient>
                        <clipPath id="bottleClipPath">
                            <path d="M20,135 L20,40 C20,25 25,15 35,15 L45,15 C55,15 60,25 60,40 L60,135 Z" />
                        </clipPath>
                    </defs>
                    <rect x="28" y="5" width="24" height="10" rx="3" fill="#6c757d"/>
                    <path d="M20,135 L20,40 C20,25 25,15 35,15 L45,15 C55,15 60,25 60,40 L60,135 Z" fill="#e9ecef" stroke="#adb5bd" stroke-width="1.5"/>
                     <g clip-path="url(#bottleClipPath)">
                         <rect x="18" y="${fillY}" width="44" height="${fillHeight}" fill="url(#bottleFillGradient)" style="transition: all 0.5s ease-in-out;"/>
                    </g>
                    <path d="M30,30 C40,50 40,100 30,120" stroke="rgba(255,255,255,0.7)" stroke-width="6" fill="none" stroke-linecap="round"/>
                    <text x="40" y="80" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif" font-size="16" font-weight="bold" fill="#fff" text-anchor="middle" dominant-baseline="middle">${label}</text>
                </svg>
            </div>
        `;
    }

    function gerarVisualizacao(amount, productType) {
        let itemsHtml = '';
        let label = '';
        
        if (productType === 'ph' || productType === 'alk' || productType === 'sulfate') {
            if(productType === 'ph') label = 'pH +';
            if(productType === 'alk') label = 'Alk +';
            if(productType === 'sulfate') label = 'Sulfato';

            const amountKg = (productType === 'sulfate') ? amount / 1000 : amount;
            const fullItems = Math.floor(amountKg);
            const partialAmount = amountKg - fullItems;

            for (let i = 0; i < fullItems; i++) {
                itemsHtml += createPackageSvg(1, label);
            }
            if (partialAmount > 0.01) {
                itemsHtml += createPackageSvg(partialAmount, label);
            }
        } else if (productType === 'chlorine') {
            label = 'Cloro';
            const fillPercent = Math.min(amount / 1000, 1);
            itemsHtml = createPackageSvg(fillPercent, label);
        } else if (productType === 'algicideMaintenance' || productType === 'algicideShock') {
            label = 'Algicida';
            const amountL = amount / 1000;
            const fullBottles = Math.floor(amountL);
            const partialAmount = amountL - fullBottles;

            for(let i=0; i<fullBottles; i++){
                itemsHtml += createBottleSvg(1, label);
            }
            if(partialAmount > 0.01){
                itemsHtml += createBottleSvg(partialAmount, label);
            }
        }

        return `<div class="visualizacao-produto">${itemsHtml}</div>`;
    }
    
    function exibirResultado(divId, frase, explicacao, visualizacaoHtml) {
        const resultadoDiv = document.getElementById(divId);
        const explanationTitle = translations[currentLanguage].explanationTitle;
        resultadoDiv.innerHTML = `
            <p class="frase-acao">${frase}</p>
            ${visualizacaoHtml || ''}
            <div class="explicacao-calculo"><strong>${explanationTitle}</strong><br>${explicacao}</div>`;
        resultadoDiv.style.display = 'block';
    }

    function calcularAlcalinidade() {
        const params = getPoolParameters();
        if (!params) return;
        const { volume, potencia } = params;
        
        const atual = parseFloat(document.getElementById('alcalinidadeAtual').value);
        const desejado = parseFloat(document.getElementById('alcalinidadeDesejada').value);
        if (isNaN(atual) || isNaN(desejado)) {
            exibirResultado('resultadoAlcalinidade', translations[currentLanguage].alertFillFields, '', '');
            return;
        }
        if (atual >= desejado) {
            exibirResultado('resultadoAlcalinidade', translations[currentLanguage].alkOk, '', '');
            return;
        }
        
        const volumeM3 = volume / 1000;
        const gramasPorM3Por10PPM = 18;
        const aumentoNecessario = desejado - atual;
        const dosagemGramas = volumeM3 * gramasPorM3Por10PPM * (aumentoNecessario / 10);
        const dosagemKg = dosagemGramas / 1000;
        const tempoHoras = calculateFiltrationTime(volume, potencia);

        let frase = translations[currentLanguage].alkAction.replace('{amount}', dosagemKg.toFixed(2));
        if(tempoHoras > 0) frase += translations[currentLanguage].filtrationTimeText.replace('{hours}', tempoHoras.toFixed(1));

        const explicacao = [
            translations[currentLanguage].volumeLine.replace('{volume}', volume.toLocaleString()).replace('{volumeM3}', volumeM3.toFixed(2)),
            translations[currentLanguage].alkIncreaseLine.replace('{current}', atual).replace('{desired}', desejado).replace('{diff}', aumentoNecessario.toFixed(0)),
            translations[currentLanguage].alkDosageLine.replace('{dosage}', gramasPorM3Por10PPM),
            translations[currentLanguage].alkCalculationLine.replace('{volumeM3}', volumeM3.toFixed(2)).replace('{dosage}', gramasPorM3Por10PPM).replace('{diff}', aumentoNecessario.toFixed(0)).replace('{result}', dosagemGramas.toFixed(2))
        ].join('<br>');
        const visualizacaoHtml = gerarVisualizacao(dosagemKg, 'alk');

        exibirResultado('resultadoAlcalinidade', frase, explicacao, visualizacaoHtml);
    }

    function calcularPhCloroCombinado() {
        const params = getPoolParameters();
        if (!params) return;
        const { volume, potencia } = params;

        const phAtual = parseFloat(document.getElementById('phCloroAtual').value);
        const phDesejado = parseFloat(document.getElementById('phCloroDesejado').value);
        const cloroAtual = parseFloat(document.getElementById('cloroPhCloroAtual').value);
        const cloroDesejado = parseFloat(document.getElementById('cloroPhCloroDesejado').value);

        if (isNaN(phAtual) || isNaN(phDesejado) || isNaN(cloroAtual) || isNaN(cloroDesejado)) {
            exibirResultado('resultadoPhCloro', translations[currentLanguage].alertFillFields, '', '');
            return;
        }
        
        const volumeM3 = volume / 1000;

        // Step 1: Calculate Chlorine
        const gramasCloroPorM3PorPPM = 1.5;
        const aumentoCloroNecessario = cloroDesejado > cloroAtual ? cloroDesejado - cloroAtual : 0;
        const dosagemCloroGramas = volumeM3 * gramasCloroPorM3PorPPM * aumentoCloroNecessario;

        // Step 2: Estimate pH increase from chlorine
        const phAumentoCloro = aumentoCloroNecessario > 0 ? 0.1 : 0;
        const phIntermediario = phAtual + phAumentoCloro;

        // Step 3: Calculate remaining soda ash needed
        let dosagemBarrilhaKg = 0;
        let dosagemBarrilhaGramas = 0;
        const aumentoPhNecessario = phDesejado - phIntermediario;

        if (aumentoPhNecessario > 0) {
            const gramasBarrilhaPorM3PorPonto = 6;
            dosagemBarrilhaGramas = volumeM3 * gramasBarrilhaPorM3PorPonto * (aumentoPhNecessario / 0.1);
            dosagemBarrilhaKg = dosagemBarrilhaGramas / 1000;
        }
        
        let frase;
        if (dosagemBarrilhaKg > 0.01) {
            frase = translations[currentLanguage].phCloroAction
                .replace('{amountChlorine}', dosagemCloroGramas.toFixed(0))
                .replace('{amountSoda}', dosagemBarrilhaKg.toFixed(2));
            frase += translations[currentLanguage].sodaAshWarning;
        } else {
            frase = translations[currentLanguage].phCloroActionOnlyChlorine
                .replace('{amountChlorine}', dosagemCloroGramas.toFixed(0));
        }

        const tempoHoras = calculateFiltrationTime(volume, potencia);
        if (tempoHoras > 0) frase += translations[currentLanguage].filtrationTimeText.replace('{hours}', tempoHoras.toFixed(1));

        const explicacao = [
            `<b>Cloro:</b> ${translations[currentLanguage].chlorineCalculationLine.replace('{volumeM3}', volumeM3.toFixed(2)).replace('{dosage}', gramasCloroPorM3PorPPM).replace('{diff}', aumentoCloroNecessario.toFixed(2)).replace('{result}', dosagemCloroGramas.toFixed(2))}`,
            `<b>Barrilha:</b> pH após cloro: ${phIntermediario.toFixed(2)}. Aumento restante: ${(aumentoPhNecessario > 0 ? aumentoPhNecessario : 0).toFixed(2)}. ${translations[currentLanguage].phCalculationLine.replace('{volumeM3}', volumeM3.toFixed(2)).replace('{dosage}', 6).replace('{diff}', (aumentoPhNecessario > 0 ? aumentoPhNecessario : 0).toFixed(1)).replace('{result}', dosagemBarrilhaGramas.toFixed(2))}`
        ].join('<br>');
        
        const visualizacaoCloro = (dosagemCloroGramas > 0) ? gerarVisualizacao(dosagemCloroGramas, 'chlorine') : '';
        const visualizacaoBarrilha = (dosagemBarrilhaKg > 0.01) ? gerarVisualizacao(dosagemBarrilhaKg, 'ph') : '';
        const visualizacaoHtml = visualizacaoCloro + visualizacaoBarrilha;

        exibirResultado('resultadoPhCloro', frase, explicacao, visualizacaoHtml);
    }
    
    function calcularPH() {
        const params = getPoolParameters();
        if (!params) return;
        const { volume, potencia } = params;

        const atual = parseFloat(document.getElementById('phAtual').value);
        const desejado = parseFloat(document.getElementById('phDesejado').value);
        if (isNaN(atual) || isNaN(desejado)) {
            exibirResultado('resultadoPH', translations[currentLanguage].alertFillFields, '', '');
            return;
        }
        if (atual >= desejado) {
            exibirResultado('resultadoPH', translations[currentLanguage].phOk, '', '');
            return;
        }

        const volumeM3 = volume / 1000;
        const gramasPorM3PorPonto = 6;
        const aumentoNecessario = desejado - atual;
        const dosagemGramas = volumeM3 * gramasPorM3PorPonto * (aumentoNecessario / 0.1);
        const dosagemKg = dosagemGramas / 1000;
        const tempoHoras = calculateFiltrationTime(volume, potencia);

        let frase = translations[currentLanguage].phAction.replace('{amount}', dosagemKg.toFixed(2));
        frase += translations[currentLanguage].sodaAshWarning;
        if (tempoHoras > 0) frase += translations[currentLanguage].filtrationTimeText.replace('{hours}', tempoHoras.toFixed(1));
        
        const explicacao = [
            translations[currentLanguage].volumeLine.replace('{volume}', volume.toLocaleString()).replace('{volumeM3}', volumeM3.toFixed(2)),
            translations[currentLanguage].phIncreaseLine.replace('{current}', atual).replace('{desired}', desejado).replace('{diff}', aumentoNecessario.toFixed(1)),
            translations[currentLanguage].phDosageLine.replace('{dosage}', gramasPorM3PorPonto),
            translations[currentLanguage].phCalculationLine.replace('{volumeM3}', volumeM3.toFixed(2)).replace('{dosage}', gramasPorM3PorPonto).replace('{diff}', aumentoNecessario.toFixed(1)).replace('{result}', dosagemGramas.toFixed(2))
        ].join('<br>');
        const visualizacaoHtml = gerarVisualizacao(dosagemKg, 'ph');

        exibirResultado('resultadoPH', frase, explicacao, visualizacaoHtml);
    }

    function calcularCloro() {
        const params = getPoolParameters();
        if (!params) return;
        const { volume, potencia } = params;

        const atual = parseFloat(document.getElementById('cloroAtual').value);
        const desejado = parseFloat(document.getElementById('cloroDesejado').value);

        if (isNaN(atual) || isNaN(desejado)) {
            exibirResultado('resultadoCloro', translations[currentLanguage].alertFillFields, '', '');
            return;
        }
        
        const volumeM3 = volume / 1000;
        const gramasPorM3PorPPM = 1.5;
        const aumentoNecessario = desejado > atual ? desejado - atual : 0;
        const dosagemGramas = volumeM3 * gramasPorM3PorPPM * aumentoNecessario;

        let frase = translations[currentLanguage].chlorineAction.replace('{amount}', dosagemGramas.toFixed(0));
        if (aumentoNecessario <= 0) {
            frase = "Nível de cloro está adequado ou acima do desejado. Nenhuma adição necessária.";
        }
        
        const tempoHoras = calculateFiltrationTime(volume, potencia);
        if (tempoHoras > 0 && aumentoNecessario > 0) frase += translations[currentLanguage].filtrationTimeText.replace('{hours}', tempoHoras.toFixed(1));

        const explicacao = [
             translations[currentLanguage].volumeLine.replace('{volume}', volume.toLocaleString()).replace('{volumeM3}', volumeM3.toFixed(2)),
             translations[currentLanguage].chlorineIncreaseLine.replace('{current}', atual).replace('{desired}', desejado).replace('{diff}', aumentoNecessario.toFixed(2)),
             translations[currentLanguage].chlorineDosageLine.replace('{dosage}', gramasPorM3PorPPM),
             translations[currentLanguage].chlorineCalculationLine.replace('{volumeM3}', volumeM3.toFixed(2)).replace('{dosage}', gramasPorM3PorPPM).replace('{diff}', aumentoNecessario.toFixed(2)).replace('{result}', dosagemGramas.toFixed(2))
        ].join('<br>');
        const visualizacaoHtml = gerarVisualizacao(dosagemGramas, 'chlorine');
        
        exibirResultado('resultadoCloro', frase, explicacao, visualizacaoHtml);
    }

    function calcularSulfato() {
        const params = getPoolParameters();
        if (!params) return;
        const { volume, potencia } = params;
        
        const volumeM3 = volume / 1000;
        const gramasPorM3 = 40;
        const dosagemGramas = volumeM3 * gramasPorM3;
        const tempoHoras = calculateFiltrationTime(volume, potencia);

        let frase = translations[currentLanguage].sulfateAction.replace('{amount}', dosagemGramas.toFixed(0));
        if(tempoHoras > 0) {
            frase += translations[currentLanguage].sulfateTimeText.replace('{hours}', tempoHoras.toFixed(1));
            frase += translations[currentLanguage].sulfateWarningText;
        }

        const explicacao = [
             translations[currentLanguage].volumeLine.replace('{volume}', volume.toLocaleString()).replace('{volumeM3}', volumeM3.toFixed(2)),
             translations[currentLanguage].sulfateDosageLine.replace('{dosage}', gramasPorM3),
             translations[currentLanguage].sulfateCalculationLine.replace('{volumeM3}', volumeM3.toFixed(2)).replace('{dosage}', gramasPorM3).replace('{result}', dosagemGramas.toFixed(2))
        ].join('<br>');
        const visualizacaoHtml = gerarVisualizacao(dosagemGramas, 'sulfate');
        
        exibirResultado('resultadoSulfato', frase, explicacao, visualizacaoHtml);
    }

    function calcularAlgicidaManutencao() {
        const params = getPoolParameters();
        if (!params) return;
        const { volume, potencia } = params;

        const volumeM3 = volume / 1000;
        const mlPorM3 = 5;
        const dosagemMl = volumeM3 * mlPorM3;
        const tempoHoras = calculateFiltrationTime(volume, potencia);

        let frase = translations[currentLanguage].algicideMaintenanceAction.replace('{amount}', dosagemMl.toFixed(0));
        if (tempoHoras > 0) frase += translations[currentLanguage].filtrationTimeText.replace('{hours}', tempoHoras.toFixed(1));
        
        const explicacao = [
            translations[currentLanguage].volumeLine.replace('{volume}', volume.toLocaleString()).replace('{volumeM3}', volumeM3.toFixed(2)),
            translations[currentLanguage].algicideDosageLine.replace('{dosage}', mlPorM3),
            translations[currentLanguage].algicideCalculationLine.replace('{volumeM3}', volumeM3.toFixed(2)).replace('{dosage}', mlPorM3).replace('{result}', dosagemMl.toFixed(2))
        ].join('<br>');
        const visualizacaoHtml = gerarVisualizacao(dosagemMl, 'algicideMaintenance');

        exibirResultado('resultadoAlgicidaManutencao', frase, explicacao, visualizacaoHtml);
    }

    function calcularAlgicidaChoque() {
        const params = getPoolParameters();
        if (!params) return;
        const { volume, potencia } = params;

        const volumeM3 = volume / 1000;
        const mlPorM3 = 10;
        const dosagemMl = volumeM3 * mlPorM3;
        const tempoHoras = calculateFiltrationTime(volume, potencia);

        let frase = translations[currentLanguage].algicideShockAction.replace('{amount}', dosagemMl.toFixed(0));
        if (tempoHoras > 0) frase += translations[currentLanguage].filtrationTimeText.replace('{hours}', tempoHoras.toFixed(1));

        const explicacao = [
            translations[currentLanguage].volumeLine.replace('{volume}', volume.toLocaleString()).replace('{volumeM3}', volumeM3.toFixed(2)),
            translations[currentLanguage].algicideDosageLine.replace('{dosage}', mlPorM3),
            translations[currentLanguage].algicideCalculationLine.replace('{volumeM3}', volumeM3.toFixed(2)).replace('{dosage}', mlPorM3).replace('{result}', dosagemMl.toFixed(2))
        ].join('<br>');
        const visualizacaoHtml = gerarVisualizacao(dosagemMl, 'algicideShock');

        exibirResultado('resultadoAlgicidaChoque', frase, explicacao, visualizacaoHtml);
    }
</script>

</body>
</html>

